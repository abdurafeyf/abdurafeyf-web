---
// Header.astro
import HeaderLink from "./HeaderLink.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../config";
---

<header class="site-header" role="banner">
  <div class="left">
    <a class="brand" href="/" aria-label={SITE_TITLE}>
      <div class="brand-title">{SITE_TITLE}</div>
      <div class="brand-sub">{SITE_DESCRIPTION}</div>
    </a>
  </div>

  <nav class="center" role="navigation" aria-label="Main">
    <HeaderLink href="/" class="nav-link">home</HeaderLink>
    <HeaderLink href="/posts" class="nav-link">posts</HeaderLink>
    <!-- add more links if needed -->
  </nav>

  <div class="right">
    <!-- compact music pill -->
    <button
      id="music-toggle"
      class="music-pill"
      type="button"
      aria-haspopup="dialog"
      aria-controls="music-player"
      aria-expanded="false"
    >
      <span class="pill-art" aria-hidden="true"></span>
      <span class="pill-text">Listen</span>
      <svg class="pill-icon" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor" d="M8 5v14l11-7z"></path>
      </svg>
    </button>

    <!-- small circular avatar -->
    <a href="/about" class="avatar" aria-label="Profile"></a>
  </div>
</header>

<!-- overlay/backdrop -->
<div id="backdrop" class="backdrop hidden" aria-hidden="true"></div>

<!-- centered modal -->
<div
  id="music-player"
  class="modal hidden"
  role="dialog"
  aria-modal="true"
  aria-hidden="true"
  aria-label="Music player"
>
  <div class="modal-card">
    <div class="modal-head">
      <div class="modal-title">Now playing</div>
      <button
        id="close-player"
        class="modal-close"
        type="button"
        aria-label="Close player">âœ•</button
      >
    </div>

    <iframe
      src="https://open.spotify.com/embed/track/4iV5W9uYEdYUVa79Axb7Rh?utm_source=generator&theme=0"
      width="100%"
      height="152"
      frameborder="0"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
      loading="lazy"
      style="border-radius:8px;"></iframe>
  </div>
</div>

<style>
  :root {
    --gap: 16px;
    --muted: #6b7280;
    --accent: #1db954;
    --bg: #ffffff;
    --glass: rgba(255, 255, 255, 0.7);
  }

  /* utility */
  .hidden {
    display: none !important;
  }

  /* header layout */
  .site-header {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: var(--gap);
    padding: 12px 18px;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.6),
      rgba(255, 255, 255, 0.9)
    );
    backdrop-filter: blur(6px);
    border-bottom: 1px solid #efefef;
  }

  .left {
    justify-self: start;
  }
  .center {
    justify-self: center;
    display: flex;
    gap: 18px;
    align-items: center;
  }
  .right {
    justify-self: end;
    display: flex;
    gap: 12px;
    align-items: center;
  }

  /* brand */
  .brand {
    display: flex;
    flex-direction: column;
    gap: 2px;
    text-decoration: none;
    color: inherit;
  }
  .brand-title {
    font-weight: 700;
    font-size: 1rem;
    line-height: 1;
    color: #111827;
  }
  .brand-sub {
    font-size: 0.78rem;
    color: var(--muted);
    margin-top: 2px;
  }

  /* nav links: simple, legible */
  .nav-link {
    padding: 8px 10px;
    border-radius: 8px;
    font-weight: 600;
    color: var(--muted);
    text-decoration: none;
    transition:
      background 0.15s,
      color 0.15s;
  }
  .nav-link:hover,
  .nav-link:focus {
    background: rgba(0, 0, 0, 0.04);
    color: #111827;
    outline: none;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.04);
  }

  /* music pill (compact, readable) */
  .music-pill {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 6px 10px;
    background: #fff;
    border: 1px solid rgba(17, 24, 39, 0.06);
    border-radius: 999px;
    cursor: pointer;
    box-shadow: 0 8px 24px rgba(2, 6, 23, 0.04);
    transition:
      transform 0.12s ease,
      box-shadow 0.12s ease,
      background 0.12s ease;
    color: #111827;
    font-weight: 600;
  }
  .music-pill:focus {
    outline: none;
    box-shadow: 0 0 0 6px rgba(29, 185, 84, 0.08);
    transform: translateY(-1px);
  }
  .music-pill:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(2, 6, 23, 0.06);
    background: var(--glass);
  }

  .pill-art {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background-image: url("/standing-profile.jpg");
    background-size: cover;
    background-position: center;
    flex: 0 0 36px;
    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
  }

  .pill-text {
    font-size: 0.92rem;
  }
  .pill-icon {
    width: 18px;
    height: 18px;
    color: var(--muted);
  }

  /* avatar - tiny circle */
  .avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background-image: url("/standing-profile.jpg");
    background-size: cover;
    background-position: center;
    display: inline-block;
    border: 2px solid transparent;
    transition:
      transform 0.15s,
      box-shadow 0.15s;
  }
  .avatar:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
    border-color: rgba(0, 0, 0, 0.04);
  }

  /* backdrop & modal (centered, small) */
  .backdrop {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.45);
    z-index: 1200;
    opacity: 0;
    transition: opacity 0.22s ease;
  }
  .backdrop.visible {
    opacity: 1;
  }

  .modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.98);
    z-index: 1250;
    opacity: 0;
    transition:
      transform 0.22s cubic-bezier(0.2, 0.9, 0.2, 1),
      opacity 0.22s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .modal.visible {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .modal-card {
    width: 360px;
    max-width: calc(100% - 40px);
    background: #fff;
    border-radius: 12px;
    padding: 14px;
    box-shadow: 0 20px 50px rgba(2, 6, 23, 0.15);
  }

  .modal-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .modal-title {
    font-weight: 700;
    font-size: 0.95rem;
    color: #111827;
  }
  .modal-close {
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 18px;
    padding: 6px;
    border-radius: 6px;
    transition: background 0.12s;
  }
  .modal-close:hover {
    background: rgba(0, 0, 0, 0.04);
  }

  /* hide page scroll when modal open */
  body.modal-open {
    overflow: hidden;
  }

  /* responsive tweaks */
  @media (max-width: 800px) {
    .site-header {
      grid-template-columns: 1fr auto;
    }
    .center {
      display: none;
    } /* collapse nav on small; you can add a mobile menu later */
    .brand-sub {
      display: none;
    }
  }
</style>

<script>
  (function () {
    function ready(fn) {
      if (document.readyState === "loading")
        document.addEventListener("DOMContentLoaded", fn);
      else fn();
    }

    ready(function () {
      const toggle = document.getElementById("music-toggle");
      const modal = document.getElementById("music-player");
      const closeBtn = document.getElementById("close-player");
      const backdrop = document.getElementById("backdrop");

      if (!toggle || !modal || !backdrop) return;

      function open() {
        backdrop.classList.remove("hidden");
        modal.classList.remove("hidden");
        // force reflow for transition
        void backdrop.offsetHeight;
        backdrop.classList.add("visible");
        modal.classList.add("visible");
        document.body.classList.add("modal-open");
        toggle.setAttribute("aria-expanded", "true");
        modal.setAttribute("aria-hidden", "false");
        backdrop.setAttribute("aria-hidden", "false");
      }

      function close() {
        backdrop.classList.remove("visible");
        modal.classList.remove("visible");
        document.body.classList.remove("modal-open");
        toggle.setAttribute("aria-expanded", "false");
        modal.setAttribute("aria-hidden", "true");
        backdrop.setAttribute("aria-hidden", "true");
        setTimeout(() => {
          backdrop.classList.add("hidden");
          modal.classList.add("hidden");
        }, 250);
      }

      toggle.addEventListener("click", function (e) {
        e.stopPropagation();
        const isOpen = modal.classList.contains("visible");
        if (isOpen) close();
        else open();
      });

      // attach close button handler if it exists inside modal (keeps HTML minimal)
      const insideClose = document.getElementById("close-player");
      if (insideClose) insideClose.addEventListener("click", close);

      backdrop.addEventListener("click", function (e) {
        if (e.target === backdrop) close();
      });

      document.addEventListener("keydown", function (e) {
        if (
          (e.key === "Escape" || e.key === "Esc") &&
          modal.classList.contains("visible")
        )
          close();
      });
    });
  })();
</script>
